{% extends 'base/default.html' %}
{% load bootstrap5 %}
{% load custom_filters %}

{% block title %}
  {% if set.serial %}
    Set {{ set.serial }}
  {% else %}
    Order №{{ order }}
  {% endif %}
{% endblock title %}

{% block content %}
<div>
  {% for set in sets %}
  <div style="break-inside:avoid;break-after:always;">
    <table class="table table-info table-striped text-center" aria-describedby="Set info for {{ set.serial }}">
      <thead>
      <tr>
        <th>Set</th>
        <th>S/N</th>
        <th>Series</th>
      </tr>
      </thead>
      <tr>
        <td>{{ set.article }}</td>
        <td>{{ set.serial }}</td>
        <td>{{ set.article.series }}</td>
      </tr>
      {% if order %}
      <tr>
        <td colspan="3">
          <table class="table table-success table-striped" aria-describedby="Order info for {{ set.serial }}">
            <thead>
            <tr>
              <th>Distributor</th>
              <th>Recipient</th>
              <th>City</th>
              <th>Date</th>
              <th>Document</th>
            </tr>
            </thead>
            <tr>
              <td>{{ order.distributor }}</td>
              <td>{{ order.recipient }}</td>
              <td>{{ order.city }}</td>
              <td>{{ order.date }}</td>
              <td>{{ order.document }}</td>
            </tr>
          </table>
        </td>
      </tr>
      {% endif %}
    </table>

    <div class="text-center d-print-none">
      <a href="{% url 'set_edit' pk=set.pk %}" role="button" class="btn btn-outline-primary">Edit set</a>
      {% if 'order' in request.path %}
      <a href="{% url 'set_detail' pk=set.pk %}" role="button" class="btn btn-outline-primary">View set</a>
      <a href="{% url 'order_edit' pk=order.pk %}" role="button" class="btn btn-outline-primary">Edit order</a>
      {% else %}
        {% if order %}
        <a href="{% url 'order_detail' pk=order.pk %}" role="button" class="btn btn-outline-primary">View order</a>
        {% endif %}
      {% endif %}
    </div>


    {% for tray in set_items|get_values:set.serial %}
    <table class="table table-striped table-sm caption-top" aria-describedby="Set item list for {{ set.serial }}"
           style="break-inside:avoid">
      {% if tray == 0 %}
        <caption>Optional tools</caption>
      {% else %}
        <caption>Tray №{{ tray }}</caption>
      {% endif %}
      <thead>
        <tr>
          <th>№</th>
          <th>Article</th>
          <th>Name</th>
          <th>Amount</th>
        </tr>
      </thead>
      {% for setitem in set_items|get_values:set.serial|get_values:tray %}
      <tr>
        <td>{{ forloop.counter }}</td>
        <td>{{ setitem.item }}</td>
        <td>{{ setitem.item.name }}</td>
        <td>{{ setitem.amount }} pcs</td>
      </tr>
      {% endfor %}
    </table>
    {% endfor %}
  </div>
  {% endfor %}
</div>

{% endblock content %}