{% extends 'base/default.html' %}
{% load render_table from django_tables2 %}
{% load export_url from django_tables2 %}
{% load bootstrap5 %}
{% load static %}

{% block title %}{{ title }}{% endblock title %}

{% block content %}
{% bootstrap_messages %}
<script type="text/javascript" src="{% static 'admin/js/vendor/jquery/jquery.js' %}"></script>

{% if filter %}
<!--FIXME: filter disappears if form is invalid-->
  <form class="" action="" method="get" >
    <div class="input-group">
      <span class="input-group-text" id="basic-addon1">Items: {{ object_list|length }}</span>
      {{ filter.form.media }}
      {% bootstrap_form filter.form layout='inline' %}
      {% bootstrap_button content='Filter' %}
      {% if filter.is_bound %}
        <a href="{% url request.resolver_match.view_name %}" class="btn btn-outline-primary">Clear filters</a>
      {% endif %}
      <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">Export</button>
        <ul class="dropdown-menu">
          <li><a class="dropdown-item" href="{% export_url 'xls' %}">XLS</a></li>
          <li><a class="dropdown-item" href="{% export_url 'xlsx' %}">XLSX</a></li>
        </ul>
      </div>
  </form>
{% endif %}

{% render_table table %}

{% if form %}
  <form action="" method="post" class="">
    {% csrf_token %}
    <div class="">
      <span class="input-group-text" id="">Create new {{ title.lower }}:</span>
      {% bootstrap_form form layout='' %}
      {% bootstrap_button button_type="submit" content="OK" %}
      <a href="{{request.META.HTTP_REFERER|escape}}" class="btn btn-outline-primary">Cancel</a>
    </div>
  </form>
{% endif %}

{% endblock content %}